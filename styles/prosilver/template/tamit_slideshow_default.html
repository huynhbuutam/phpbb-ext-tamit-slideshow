{% if S_SLIDESHOW_BOX == 1 %}
<div class="forabg">
<div class="inner">
	<ul class="topiclist">
		<li class="header">
			<dl class="row-item">
				<dt>
					<div class="list-inner slideshow-list-inner">{{ lang('SLIDESHOW_TITLE') }}</div>
				</dt>
			</dl>
		</li>
	</ul>
	
	<ul class="topiclist forums">
		<li class="row">
			<dl class="row-item">
				<dt>
					<div class="list-inner slideshow-list-inner" style="padding-left: 5px;{% if S_SLIDESHOW_NAV_IMAGE == 0 %} margin-right: 0 !important;{% endif %}">
{% else %}
				<div style="width: 100%; position: relative; overflow: hidden;">
					<div class="slideshow-no-wrap" style="margin-right: {% if S_SLIDESHOW_NAV_IMAGE == 0 %} 0{% else %} 110px{% endif %};">
{% endif %}
						{% if SLIDESHOW_SLIDES|length > 0 %}
						<!-- Slideshow container -->
						<div class="slideshow-container">
						<!-- Slides -->
							{% for slide in SLIDESHOW_SLIDES %}
							<div class="slideshow-slides" style="background-image: url('{{ slide.slide_image }}');">
							{% if slide.slide_title|length > 0 || slide.slide_description|length > 0 %}
							<div class="slideshow-slides-text">
							{% if slide.slide_title|length > 0 %}
							<a class="forumtitle" href="{% if slide.slide_link|length > 0 %}{{ slide.slide_link }}{% else %}#{% endif %}" title="{{ slide.slide_title }}">{{ slide.slide_title }}</a><br />
							{% endif %}
							{{ slide.slide_description }}
							</div>
							{% endif %}
							</div>
							{% endfor %}
							
							<!-- Next & previous buttons -->
							<a class="slideshow-prev" onclick="plusSlides(-1)">&#10094;</a>
							<a class="slideshow-next" onclick="plusSlides(1)">&#10095;</a>
						</div>
						{% if S_SLIDESHOW_NAV_DOT == 1 %}
						<!-- Dot navigator container -->
						<div class="slideshow-dot-navigator-container">
							{% for i in 1 .. SLIDESHOW_SLIDES|length %}
							<span class="slideshow-dot-navigator" onclick="currentSlide({{ i }})">{{ i }}</span>
							{% endfor %}
						</div>
						{% endif %}
						
						{% else %}
						{{ lang('SLIDESHOW_EMPTY') }}
						{% endif %}
					</div>
{% if S_SLIDESHOW_BOX == 1 %}
				</dt>
{% endif %}
				{% if S_SLIDESHOW_NAV_IMAGE == 1 %}
{% if S_SLIDESHOW_BOX == 1 %}
				<dd class="lastpost" style="border: 0;">
{% endif %}
					{% if SLIDESHOW_SLIDES|length > 0 %}
					<!-- Image navigator container -->
					<div class="slideshow-image-navigator-container">
						{% for slide in SLIDESHOW_SLIDES %}
						<img class="slideshow-image-navigator" src="{{ slide.slide_image }}" title="{{ slide.slide_title }}" onclick="currentSlide({{ loop.index }})"/>
						{% endfor %}
					</div>
					{% endif %}
{% if S_SLIDESHOW_BOX == 1 %}
				</dd>
{% endif %}
				{% endif %}
{% if S_SLIDESHOW_BOX == 1 %}
			</dl>
		</li>
	</ul>
</div>
{% endif %}
</div>

{% if SLIDESHOW_SLIDES|length > 0 %}
<script type="text/javascript">
var slides = document.getElementsByClassName("slideshow-slides");
var slideIndex = Math.floor(Math.random() * slides.length);
var showLoopTime = 10000;
showSlides(slideIndex);
var slideShowTimer = setInterval(loopSlides, showLoopTime);

function loopSlides() {
	slideIndex++;
	if (slideIndex > slides.length) {
		slideIndex = 1;
	}
	if (slideIndex < 1) {
		slideIndex = slides.length;
	}
	showSlides(slideIndex);
}

function plusSlides(n) {
	showSlides(slideIndex += n);
	resetShowTimer();
}

function currentSlide(n) {
	slideIndex = n;
	showSlides(n);
	resetShowTimer();
}

function resetShowTimer() {
	clearInterval(slideShowTimer);
	slideShowTimer = setInterval(loopSlides, showLoopTime);
}

function showSlides(n) {
	var i;
	if (n > slides.length) {
		slideIndex = 1;
	}
	if (n < 1) {
		slideIndex = slides.length;
	}
	for (i = 0; i < slides.length; i++) {
		slides[i].style.opacity = 0;
		slides[i].style.height= 0;
	}
	slides[slideIndex-1].style.opacity = 1;
	slides[slideIndex-1].style.height = "100%";
	
	{% if S_SLIDESHOW_NAV_DOT == 1 %}
	/* Dot navigator */
	var dotNav = document.getElementsByClassName("slideshow-dot-navigator");
	for (i = 0; i < dotNav.length; i++) {
		dotNav[i].className = dotNav[i].className.replace(" slideshow-active", "");
	}
	dotNav[slideIndex-1].className += " slideshow-active";
	{% endif %}
	{% if S_SLIDESHOW_NAV_IMAGE == 1 %}
	/* Image navigator */
	var imgNav = document.getElementsByClassName("slideshow-image-navigator");
	for (i = 0; i < imgNav.length; i++) {
		imgNav[i].className = imgNav[i].className.replace(" slideshow-active", "");
	}
	imgNav[slideIndex-1].className += " slideshow-active";
	imgNav[slideIndex-1].parentElement.scrollTop = imgNav[slideIndex-1].offsetTop;
	{% endif %}
}

/* Swipe event */
for (i = 0; i < slides.length; i++) {
	slides[i].addEventListener('touchstart', handleTouchStart, false);
	slides[i].addEventListener('touchmove', slideShow_handleTouchMove, false);
}

var xDown = null;
var yDown = null;

function getTouches(evt) {
	return evt.touches || evt.originalEvent.touches; // jQuery
}

function handleTouchStart(evt) {
	const firstTouch = getTouches(evt)[0];
	xDown = firstTouch.clientX;
	yDown = firstTouch.clientY;
};

function slideShow_handleTouchMove(evt) {
	if (!xDown || !yDown) {
		return;
	}

	var xUp = evt.touches[0].clientX;
	var yUp = evt.touches[0].clientY;

	var xDiff = xDown - xUp;
	var yDiff = yDown - yUp;

	/* Most significant */
	if (Math.abs(xDiff) > Math.abs(yDiff)) {
		if (xDiff > 0) {
			/* Swipe right */
			plusSlides(1);
		} else {
			/* Swipe left */
			plusSlides(-1);
		}
	} else {
		if (yDiff > 0) {
			/* Swipe down */ 
		} else { 
			/* Swipe up */
		}
	}
	/* Reset values */
	xDown = null;
	yDown = null;
};
</script>
{% endif %}